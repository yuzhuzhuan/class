<template>
  <YkDialog
    v-bind="attrsM"
    :title="$t('user.editUser')"
    ok-text="保存"
    width="1000px"
    v-on="listenersM"
  >
    <template #icon>
      <i class="text-2xl dw-title-ic iconfont icon-bianji"></i>
    </template>
    <el-form
      ref="dialogFormM"
      inline
      :model="dialogFormM"
      :label-width="5 + 2 + 'em'"
      class="max-w-full auto-rows-auto grid gap-0 grid-cols-[2fr_2fr]"
    >
      <!-- (0-9，a-z(a-z)) -->
      <yk-form-item
        :label="$t('user.userName').toString()"
        prop="username"
        required
        :rules="rules.username"
      >
        <yk-input v-model.trim="dialogFormM.username" />
      </yk-form-item>
      <yk-form-item :label="$t('user.name').toString()" prop="name" required>
        <yk-input v-model.trim="dialogFormM.name" />
      </yk-form-item>
      <!-- (0-9，a-z(a-z)) -->
      <yk-form-item
        :label="$t('user.password').toString()"
        prop="password"
        required
        :rules="rules.password"
      >
        <yk-input v-model.trim="dialogFormM.password" type="password" />
      </yk-form-item>
      <yk-form-item
        :label="$t('user.usertype').toString()"
        prop="usertype"
        required
        rule-type="number"
      >
        <yk-select v-model.trim="dialogFormM.usertype" :options="ykOpts.roletypeOpts" />
      </yk-form-item>
      <!-- (0-停用/1-启用) -->
      <yk-form-item :label="$t('user.enable').toString()" prop="enable" required rule-type="number">
        <yk-select v-model.trim="dialogFormM.enable" :options="ykOpts.enableOpts" />
      </yk-form-item>
    </el-form>
  </YkDialog>
</template>

<script lang="ts">
import { Component, Mixins } from 'vue-property-decorator';
import { MixinDialog } from '@/plugins/mixins';
import service from '@/api/user';

@Component({})
export default class DialogUserEdit extends Mixins<MixinDialog<UserItem>>(MixinDialog) {
  rules = {
    username: [{ pattern: /^[0-9a-zA-Z]+$/, message: '请输入0-9a-zA-Z的字符' }],
    password: [{ pattern: /^[0-9a-zA-Z]+$/, message: '请输入0-9a-zA-Z的字符' }],
  };

  dialogFormM = {
    username: '',
    name: '',
    password: '',
    enable: 1,
    usertype: 1,
  };

  detailRequestM = service.detail;
  async saveM() {
    const formData = await this.getFormDataM<DialogUserEdit['dialogFormM']>();
    let res = null;
    if (this.dataM?.id) {
      res = await service.update(formData);
    } else {
      res = await service.create(formData);
    }
    return res.data;
  }
}
</script>
